# C++ å°è£…ç‰¹æ€§å…¨é¢è§£æ

## ğŸ“¦ å°è£…æ ¸å¿ƒæ¦‚å¿µå›¾è§£

```mermaid
graph TD
    A[å°è£…] --> B[è®¿é—®æ§åˆ¶]
    A --> C[æˆå‘˜å±æ€§]
    A --> D[æˆå‘˜æ–¹æ³•]
    A --> E[æ„é€ å‡½æ•°]
    A --> F[ææ„å‡½æ•°]
    A --> G[thisæŒ‡é’ˆ]
    A --> H[å‹å…ƒ]
    A --> I[é™æ€æˆå‘˜]
    A --> J[å¸¸æˆå‘˜]
```

## 1. å°è£…çš„åŸºæœ¬æ¦‚å¿µ

### å®šä¹‰ä¸ä½œç”¨
- **å°è£…**ï¼šå°†æ•°æ®ï¼ˆå±æ€§ï¼‰å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰ç»‘å®šä¸ºå•ä¸€å•å…ƒï¼ˆç±»ï¼‰
- **æ ¸å¿ƒæ€æƒ³**ï¼šéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œä»…æš´éœ²å¿…è¦æ¥å£
- **ä¸‰å¤§ç‰¹æ€§**ï¼š
  - **æ•°æ®éšè—**ï¼šé€šè¿‡è®¿é—®ä¿®é¥°ç¬¦æ§åˆ¶æ•°æ®å¯è§æ€§
  - **æ•°æ®æŠ½è±¡**ï¼šä»…æš´éœ²æ“ä½œæ¥å£è€Œéå®ç°ç»†èŠ‚
  - **ä¿¡æ¯ä¿æŠ¤**ï¼šé˜²æ­¢å¤–éƒ¨ç›´æ¥è®¿é—®å†…éƒ¨æ•°æ®

### å°è£…ä¼˜åŠ¿
1. æé«˜ä»£ç å®‰å…¨æ€§
2. é™ä½ç³»ç»Ÿè€¦åˆåº¦
3. å¢å¼ºä»£ç å¯ç»´æŠ¤æ€§
4. å®ç°æ¨¡å—åŒ–è®¾è®¡

## 2. è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦

| ä¿®é¥°ç¬¦ | ç±»å†…è®¿é—® | æ´¾ç”Ÿç±»è®¿é—® | å¤–éƒ¨è®¿é—® | ç‰¹ç‚¹ |
|--------|----------|------------|----------|------|
| `private` | âœ“ | âœ— | âœ— | **é»˜è®¤è®¿é—®çº§åˆ«**ï¼Œå®Œå…¨å°è£… |
| `protected` | âœ“ | âœ“ | âœ— | å…è®¸æ´¾ç”Ÿç±»è®¿é—® |
| `public` | âœ“ | âœ“ | âœ“ | å®Œå…¨å¼€æ”¾è®¿é—® |

### è®¿é—®æ§åˆ¶ç¤ºä¾‹
```cpp
class BankAccount {
private:    // å®Œå…¨å°è£…
    string accountNumber;
    double balance;
    
protected:  // éƒ¨åˆ†å¼€æ”¾
    string ownerName;
    
public:     // å®Œå…¨å¼€æ”¾
    // å…¬å¼€æ¥å£
    void deposit(double amount) {
        if (amount > 0) balance += amount;
    }
    
    double getBalance() const {
        return balance;
    }
};
```

## 3. æˆå‘˜å±æ€§

### ç‰¹æ€§ä¸è§„èŒƒ
- **æ•°æ®å°è£…**ï¼šå±æ€§é€šå¸¸å£°æ˜ä¸º`private`
- **å‘½åè§„èŒƒ**ï¼šæˆå‘˜å˜é‡å¸¸ç”¨`m_`å‰ç¼€æˆ–`_`åç¼€
- **è®¿é—®æ§åˆ¶**ï¼šé€šè¿‡å…¬æœ‰æ–¹æ³•è®¿é—®ç§æœ‰å±æ€§

### ç¤ºä¾‹ï¼šå®‰å…¨å±æ€§è®¿é—®
```cpp
class Person {
private:
    string m_name;  // ç§æœ‰æˆå‘˜
    int m_age;
    
public:
    // è®¾ç½®å§“åï¼ˆå¸¦æ ¡éªŒï¼‰
    void setName(const string& name) {
        if (!name.empty()) m_name = name;
    }
    
    // è·å–å§“å
    string getName() const {
        return m_name;
    }
    
    // è®¾ç½®å¹´é¾„ï¼ˆå¸¦æ ¡éªŒï¼‰
    void setAge(int age) {
        if (age >= 0 && age <= 150) m_age = age;
    }
    
    // è·å–å¹´é¾„
    int getAge() const {
        return m_age;
    }
};
```

## 4. æˆå‘˜æ–¹æ³•

### æ–¹æ³•ç±»å‹
| æ–¹æ³•ç±»å‹ | ç‰¹ç‚¹ | ç¤ºä¾‹ |
|----------|------|------|
| æ™®é€šæ–¹æ³• | æ“ä½œå¯¹è±¡çŠ¶æ€ | `void saveData();` |
| constæ–¹æ³• | ä¸ä¿®æ”¹å¯¹è±¡çŠ¶æ€ | `void display() const;` |
| é™æ€æ–¹æ³• | ç±»çº§åˆ«æ“ä½œ | `static int getCount();` |
| å‹å…ƒæ–¹æ³• | è®¿é—®ç§æœ‰æˆå‘˜ | `friend void audit();` |

### æ–¹æ³•å®šä¹‰
```cpp
class Rectangle {
private:
    double width;
    double height;
    
public:
    // æ™®é€šæ–¹æ³•ï¼ˆä¿®æ”¹çŠ¶æ€ï¼‰
    void resize(double w, double h) {
        width = w;
        height = h;
    }
    
    // constæ–¹æ³•ï¼ˆä¸ä¿®æ”¹çŠ¶æ€ï¼‰
    double area() const {
        return width * height;
    }
};
```

## 5. æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°

### æ„é€ å‡½æ•°ç±»å‹
| ç±»å‹ | ç‰¹ç‚¹ | è¯­æ³• |
|------|------|------|
| é»˜è®¤æ„é€  | æ— å‚æ„é€  | `ClassName();` |
| å‚æ•°åŒ–æ„é€  | å¸¦å‚æ•°æ„é€  | `ClassName(params);` |
| æ‹·è´æ„é€  | å¯¹è±¡å¤åˆ¶ | `ClassName(const ClassName&);` |
| ç§»åŠ¨æ„é€  | èµ„æºè½¬ç§» | `ClassName(ClassName&&);` |
| å§”æ‰˜æ„é€  | å¤ç”¨æ„é€  | `ClassName() : ClassName(0) {}` |

### æ„é€ /ææ„ç¤ºä¾‹
```cpp
class Student {
private:
    string name;
    int* scores;
    int count;
    
public:
    // é»˜è®¤æ„é€ 
    Student() : name(""), scores(nullptr), count(0) {}
    
    // å‚æ•°åŒ–æ„é€ 
    Student(string n, int sc[], int cnt) : name(n), count(cnt) {
        scores = new int[count];
        for (int i = 0; i < count; i++) {
            scores[i] = sc[i];
        }
    }
    
    // æ‹·è´æ„é€ ï¼ˆæ·±æ‹·è´ï¼‰
    Student(const Student& other) : name(other.name), count(other.count) {
        scores = new int[count];
        for (int i = 0; i < count; i++) {
            scores[i] = other.scores[i];
        }
    }
    
    // ææ„å‡½æ•°
    ~Student() {
        delete[] scores; // é‡Šæ”¾èµ„æº
    }
};
```

## 6. thisæŒ‡é’ˆ

### ä½œç”¨ä¸ç‰¹æ€§
- **éšå«æŒ‡é’ˆ**ï¼šæ¯ä¸ªæˆå‘˜å‡½æ•°å†…è‡ªåŠ¨åŒ…å«`this`æŒ‡é’ˆ
- **æŒ‡å‘å½“å‰å¯¹è±¡**ï¼š`this`æŒ‡å‘è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡
- **ä¸»è¦ç”¨é€”**ï¼š
  1. åŒºåˆ†æˆå‘˜ä¸å±€éƒ¨å˜é‡
  2. é“¾å¼è°ƒç”¨
  3. è¿”å›å¯¹è±¡è‡ªèº«å¼•ç”¨

### thisæŒ‡é’ˆç¤ºä¾‹
```cpp
class Counter {
private:
    int count;
    
public:
    Counter() : count(0) {}
    
    // è¿”å›è‡ªå¼•ç”¨æ”¯æŒé“¾å¼è°ƒç”¨
    Counter& increment() {
        count++;
        return *this; // è¿”å›å½“å‰å¯¹è±¡
    }
    
    // ä½¿ç”¨thisåŒºåˆ†åŒåå˜é‡
    void setCount(int count) {
        this->count = count; // this->è®¿é—®æˆå‘˜å˜é‡
    }
    
    int getCount() const {
        return count;
    }
};

int main() {
    Counter c;
    c.increment().increment().increment(); // é“¾å¼è°ƒç”¨
    cout << c.getCount(); // 3
    return 0;
}
```

## 7. å‹å…ƒï¼ˆfriendï¼‰

### å‹å…ƒç±»å‹
| ç±»å‹ | å£°æ˜æ–¹å¼ | è®¿é—®æƒé™ |
|------|----------|----------|
| å‹å…ƒå‡½æ•° | `friend void func();` | è®¿é—®æ‰€æœ‰æˆå‘˜ |
| å‹å…ƒç±» | `friend class FriendClass;` | è®¿é—®æ‰€æœ‰æˆå‘˜ |
| å‹å…ƒæˆå‘˜å‡½æ•° | `friend void OtherClass::func();` | è®¿é—®æ‰€æœ‰æˆå‘˜ |

### å‹å…ƒä½¿ç”¨ç¤ºä¾‹
```cpp
class SecretData {
private:
    string encryptedData;
    
    // ç§æœ‰åŠ å¯†æ–¹æ³•
    void encrypt() { /* ... */ }
    
public:
    SecretData(const string& data) : encryptedData(data) {
        encrypt();
    }
    
    // å£°æ˜å‹å…ƒå‡½æ•°
    friend void securityAudit(const SecretData&);
};

// å‹å…ƒå‡½æ•°å®šä¹‰
void securityAudit(const SecretData& data) {
    // å…è®¸è®¿é—®ç§æœ‰æˆå‘˜
    cout << "å®¡è®¡æ•°æ®: " << data.encryptedData << endl;
    // data.encrypt(); // é”™è¯¯ï¼åªèƒ½è®¿é—®æ•°æ®ï¼Œä¸èƒ½è°ƒç”¨ç§æœ‰æ–¹æ³•
}
```

## 8. é™æ€æˆå‘˜

### é™æ€æˆå‘˜ç‰¹æ€§
| ç‰¹æ€§ | é™æ€æˆå‘˜å˜é‡ | é™æ€æˆå‘˜å‡½æ•° |
|------|--------------|--------------|
| å­˜å‚¨ä½ç½® | å…¨å±€æ•°æ®åŒº | - |
| ç±»å†…å£°æ˜ | éœ€è¦`static`å…³é”®å­— | éœ€è¦`static`å…³é”®å­— |
| ç±»å¤–å®šä¹‰ | å¿…é¡»å®šä¹‰ | ä¸éœ€è¦ï¼ˆå¯ç›´æ¥å®šä¹‰ï¼‰ |
| è®¿é—®æ–¹å¼ | ç±»å::å˜é‡å | ç±»å::å‡½æ•°å() |
| è®¿é—®æƒé™ | å—è®¿é—®ä¿®é¥°ç¬¦é™åˆ¶ | åªèƒ½è®¿é—®é™æ€æˆå‘˜ |

### é™æ€æˆå‘˜ç¤ºä¾‹
```cpp
class Employee {
private:
    static int totalCount; // å£°æ˜é™æ€æˆå‘˜
    string name;
    
public:
    Employee(string n) : name(n) {
        totalCount++; // åˆ›å»ºæ—¶è®¡æ•°å¢åŠ 
    }
    
    ~Employee() {
        totalCount--; // é”€æ¯æ—¶è®¡æ•°å‡å°‘
    }
    
    // é™æ€æˆå‘˜å‡½æ•°
    static int getTotal() {
        return totalCount;
    }
};

// ç±»å¤–å®šä¹‰é™æ€æˆå‘˜
int Employee::totalCount = 0;

int main() {
    Employee e1("Alice");
    Employee e2("Bob");
    cout << "å‘˜å·¥æ€»æ•°: " << Employee::getTotal(); // 2
    return 0;
}
```

## 9. å¸¸æˆå‘˜ï¼ˆconstï¼‰

### å¸¸æˆå‘˜ç±»å‹
| ç±»å‹ | è¯­æ³• | ç‰¹æ€§ |
|------|------|------|
| å¸¸æˆå‘˜å˜é‡ | `const int id;` | åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ |
| å¸¸æˆå‘˜å‡½æ•° | `void display() const;` | ä¸èƒ½ä¿®æ”¹å¯¹è±¡çŠ¶æ€ |
| å¸¸å¯¹è±¡ | `const ClassName obj;` | åªèƒ½è°ƒç”¨å¸¸æ–¹æ³• |

### å¸¸æˆå‘˜ç¤ºä¾‹
```cpp
class Configuration {
private:
    const string configVersion; // å¸¸æˆå‘˜å˜é‡
    mutable int accessCount;    // mutableæˆå‘˜ï¼ˆå¯åœ¨constæ–¹æ³•ä¸­ä¿®æ”¹ï¼‰
    string settings;
    
public:
    Configuration(string ver) : configVersion(ver), accessCount(0) {}
    
    // å¸¸æˆå‘˜å‡½æ•°
    void showVersion() const {
        accessCount++; // mutableæˆå‘˜å¯ä¿®æ”¹
        cout << "é…ç½®ç‰ˆæœ¬: " << configVersion << endl;
    }
    
    // éconstæ–¹æ³•
    void updateSettings(string newSettings) {
        settings = newSettings;
    }
};

int main() {
    const Config readOnlyConfig("v1.0"); // å¸¸å¯¹è±¡
    readOnlyConfig.showVersion();        // æ­£ç¡®
    // readOnlyConfig.updateSettings(""); // é”™è¯¯ï¼å¸¸å¯¹è±¡ä¸èƒ½è°ƒç”¨éconstæ–¹æ³•
    return 0;
}
```

## ğŸš€ å°è£…é«˜çº§æŠ€å·§

### 1. RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰
```cpp
class FileHandler {
private:
    FILE* file;
    
public:
    explicit FileHandler(const char* filename, const char* mode) {
        file = fopen(filename, mode);
        if (!file) throw runtime_error("æ–‡ä»¶æ‰“å¼€å¤±è´¥");
    }
    
    ~FileHandler() {
        if (file) fclose(file);
    }
    
    // ç¦æ­¢æ‹·è´
    FileHandler(const FileHandler&) = delete;
    FileHandler& operator=(const FileHandler&) = delete;
    
    void write(const string& data) {
        if (fputs(data.c_str(), file) == EOF) {
            throw runtime_error("å†™å…¥å¤±è´¥");
        }
    }
};

void safeFileOperation() {
    FileHandler fh("data.txt", "w");
    fh.write("å®‰å…¨æ–‡ä»¶æ“ä½œ");
    // è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼ˆææ„å‡½æ•°ï¼‰
}
```

### 2. PImplï¼ˆæŒ‡é’ˆå®ç°ï¼‰æƒ¯ç”¨æ³•
```cpp
// Widget.hï¼ˆå…¬å¼€æ¥å£ï¼‰
class Widget {
public:
    Widget();
    ~Widget();
    void process();
private:
    class Impl; // å‰å‘å£°æ˜
    unique_ptr<Impl> pImpl; // å®ç°æŒ‡é’ˆ
};

// Widget.cppï¼ˆéšè—å®ç°ï¼‰
#include "Widget.h"

class Widget::Impl {
private:
    int internalData;
    void privateMethod() { /* ... */ }
public:
    void process() { /* å®é™…å®ç° */ }
};

Widget::Widget() : pImpl(make_unique<Impl>()) {}
Widget::~Widget() = default; // éœ€åœ¨cppå®šä¹‰ï¼ˆå› unique_ptréœ€è¦å®Œæ•´ç±»å‹ï¼‰
void Widget::process() { pImpl->process(); }
```

### 3. å°è£…è®¾è®¡æ¨¡å¼
```cpp
// å·¥å‚æ¨¡å¼å°è£…å¯¹è±¡åˆ›å»º
class Shape {
public:
    virtual void draw() = 0;
    virtual ~Shape() = default;
    
    // å·¥å‚æ–¹æ³•
    static unique_ptr<Shape> create(const string& type);
};

class Circle : public Shape { /* ... */ };
class Rectangle : public Shape { /* ... */ };

unique_ptr<Shape> Shape::create(const string& type) {
    if (type == "circle") return make_unique<Circle>();
    if (type == "rectangle") return make_unique<Rectangle>();
    return nullptr;
}
```

## âš ï¸ å°è£…å¸¸è§é”™è¯¯

### é”™è¯¯1ï¼šæ•°æ®æˆå‘˜å…¬å¼€
```cpp
class BadDesign {
public: // å±é™©ï¼ç ´åå°è£…
    int sensitiveData;
    string internalState;
};
```

### é”™è¯¯2ï¼šè¿”å›ç§æœ‰æˆå‘˜çš„å¼•ç”¨
```cpp
class DataContainer {
private:
    vector<int> data;
public:
    vector<int>& getData() { 
        return data; // å¤–éƒ¨å¯ç›´æ¥ä¿®æ”¹ç§æœ‰æ•°æ®
    }
};
```

### é”™è¯¯3ï¼šä¸å®Œæ•´çš„æ·±æ‹·è´
```cpp
class ShallowCopy {
private:
    int* resource;
public:
    ShallowCopy(int size) : resource(new int[size]) {}
    ~ShallowCopy() { delete[] resource; }
    
    // é”™è¯¯ï¼é»˜è®¤æ‹·è´æ„é€ æ‰§è¡Œæµ…æ‹·è´
    // éœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ å’Œèµ‹å€¼æ“ä½œç¬¦
};
```

## ğŸ“Š å°è£…æœ€ä½³å®è·µ

1. **æœ€å°æš´éœ²åŸåˆ™**ï¼šä»…æš´éœ²å¿…è¦çš„æ¥å£
2. **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªç±»åªè´Ÿè´£å•ä¸€åŠŸèƒ½
3. **æ·±æ‹·è´èµ„æº**ï¼šç®¡ç†èµ„æºçš„ç±»éœ€è‡ªå®šä¹‰æ‹·è´æ§åˆ¶
4. **ä¼˜å…ˆconstæ–¹æ³•**ï¼šä¸ä¿®æ”¹å¯¹è±¡çš„æ–¹æ³•å£°æ˜ä¸ºconst
5. **ä½¿ç”¨è®¿é—®æ–¹æ³•**ï¼šé€šè¿‡getter/setteræ§åˆ¶å±æ€§è®¿é—®
6. **èµ„æºç®¡ç†å°è£…**ï¼šä½¿ç”¨RAIIç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
7. **é¿å…å‹å…ƒæ»¥ç”¨**ï¼šä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å‹å…ƒ

```cpp
// å°è£…å…¸èŒƒç¤ºä¾‹
class SecureDatabase {
private:
    string connectionString;
    int timeout;
    mutable atomic<int> queryCount; // çº¿ç¨‹å®‰å…¨è®¡æ•°å™¨
    
    // ç§æœ‰è¿æ¥æ–¹æ³•
    void connect() { /* ... */ }
    
public:
    SecureDatabase(string conn, int tmo) 
        : connectionString(conn), timeout(tmo), queryCount(0) {}
    
    // å…¬å¼€æ¥å£
    void executeQuery(string sql) {
        connect();
        // æ‰§è¡ŒæŸ¥è¯¢...
        queryCount++;
    }
    
    // constæ–¹æ³•è®¿é—®è®¡æ•°
    int getQueryCount() const {
        return queryCount;
    }
    
    // è®¾ç½®è¶…æ—¶ï¼ˆå¸¦æ ¡éªŒï¼‰
    void setTimeout(int tmo) {
        if (tmo > 0) timeout = tmo;
    }
};
```

## ğŸ’ å°è£…è®¾è®¡åŸåˆ™æ€»ç»“

| åŸåˆ™ | è¯´æ˜ | åº”ç”¨ |
|------|------|------|
| **ä¿¡æ¯éšè—** | éšè—å®ç°ç»†èŠ‚ | ç§æœ‰æ•°æ®æˆå‘˜ |
| **æ¥å£åˆ†ç¦»** | æœ€å°åŒ–ä¾èµ–æ¥å£ | å®šä¹‰ç²¾ç®€publicæ–¹æ³• |
| **é«˜å†…èš** | ç›¸å…³åŠŸèƒ½é›†ä¸­ | ç±»å†…æ–¹æ³•ç´§å¯†ç›¸å…³ |
| **ä½è€¦åˆ** | å‡å°‘ç±»é—´ä¾èµ– | é€šè¿‡æ¥å£äº¤äº’ |
| **è¿ªç±³ç‰¹æ³•åˆ™** | æœ€å°‘çŸ¥è¯†åŸåˆ™ | é¿å…é“¾å¼è°ƒç”¨`a.b().c()` |
| **å¼€æ”¾å°é—­** | å¯¹æ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹å…³é—­ | é€šè¿‡ç»§æ‰¿æ‰©å±• |

> å°è£…æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºçŸ³ï¼Œåˆç†è¿ç”¨å°è£…èƒ½æ„å»ºå‡ºå¥å£®ã€å¯ç»´æŠ¤çš„ç³»ç»Ÿã€‚éµå¾ª"**å¼€æ”¾å¿…è¦æ¥å£ï¼Œéšè—å®ç°ç»†èŠ‚**"çš„åŸåˆ™ï¼Œè®©ä»£ç åœ¨å®‰å…¨æ€§ä¸çµæ´»æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚