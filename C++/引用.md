# C++ å¼•ç”¨å…¨é¢æŒ‡å—

## ğŸ“Œ å¼•ç”¨æ ¸å¿ƒæ¦‚å¿µå›¾è§£

```mermaid
graph TD
    A[å¼•ç”¨] --> B[åŸºæœ¬è¯­æ³•]
    A --> C[æ³¨æ„äº‹é¡¹]
    A --> D[å‡½æ•°å‚æ•°]
    A --> E[å‡½æ•°è¿”å›å€¼]
    A --> F[å¼•ç”¨çš„æœ¬è´¨]
    A --> G[å¸¸é‡å¼•ç”¨]
```

## 1. å¼•ç”¨çš„åŸºæœ¬è¯­æ³•

### å®šä¹‰ä¸ç‰¹æ€§
- **å¼•ç”¨**ï¼šå˜é‡çš„åˆ«åï¼Œé€šè¿‡å·²å­˜åœ¨å˜é‡åˆ›å»º
- **è¯­æ³•**ï¼š`æ•°æ®ç±»å‹ &åˆ«å = åŸå˜é‡å;`
- **æ ¸å¿ƒç‰¹æ€§**ï¼š
  - å¿…é¡»åˆå§‹åŒ–
  - åˆå§‹åŒ–åä¸å¯æ›´æ”¹æŒ‡å‘
  - å¯¹å¼•ç”¨çš„æ“ä½œç­‰åŒäºå¯¹åŸå˜é‡çš„æ“ä½œ

### åŸºæœ¬ä½¿ç”¨
```cpp
int num = 10;
int &ref = num; // refæ˜¯numçš„å¼•ç”¨

cout << "num = " << num << endl;   // 10
cout << "ref = " << ref << endl;   // 10

ref = 20; // é€šè¿‡å¼•ç”¨ä¿®æ”¹å€¼

cout << "num = " << num << endl;   // 20
cout << "ref = " << ref << endl;   // 20

// éªŒè¯åŒä¸€å†…å­˜
cout << "numåœ°å€: " << &num << endl;  // 0x7ff...
cout << "refåœ°å€: " << &ref << endl;  // ç›¸åŒåœ°å€
```

### å¼•ç”¨ vs æŒ‡é’ˆ
| ç‰¹æ€§ | å¼•ç”¨ | æŒ‡é’ˆ |
|------|------|------|
| åˆå§‹åŒ– | å¿…é¡»åˆå§‹åŒ– | å¯ä¸åˆå§‹åŒ– |
| ç©ºå€¼ | ä¸èƒ½ä¸ºç©º | å¯ä¸ºç©º |
| é‡å®šå‘ | ä¸å¯æ›´æ”¹æŒ‡å‘ | å¯æ›´æ”¹æŒ‡å‘ |
| æ“ä½œç¬¦ | ä½¿ç”¨`.`è®¿é—®æˆå‘˜ | ä½¿ç”¨`->`è®¿é—®æˆå‘˜ |
| å†…å­˜å ç”¨ | æ— é¢å¤–å†…å­˜ï¼ˆç¼–è¯‘å™¨å®ç°ï¼‰ | å ç”¨æŒ‡é’ˆå¤§å°å†…å­˜ |
| å®‰å…¨æ€§ | æ›´é«˜ï¼ˆæ— ç©ºå¼•ç”¨ï¼‰ | å¯èƒ½äº§ç”Ÿé‡æŒ‡é’ˆ |

## 2. å¼•ç”¨çš„æ³¨æ„äº‹é¡¹

### å…³é”®é™åˆ¶
1. **å¿…é¡»åˆå§‹åŒ–**
   ```cpp
   int a = 5;
   // int &b; // é”™è¯¯ï¼å¼•ç”¨å¿…é¡»åˆå§‹åŒ–
   int &b = a; // æ­£ç¡®
   ```

2. **ä¸å¯é‡ç»‘å®š**
   ```cpp
   int x = 10, y = 20;
   int &r = x;
   // r = y; // ä¸æ˜¯é‡ç»‘å®šï¼Œè€Œæ˜¯å°†yçš„å€¼èµ‹ç»™x
   cout << x; // 20
   ```

3. **ä¸èƒ½åˆ›å»ºå¼•ç”¨æ•°ç»„**
   ```cpp
   int arr[3] = {1,2,3};
   // int &refArr[3] = {arr[0], arr[1], arr[2]}; // éæ³•
   ```

4. **æ²¡æœ‰å¤šçº§å¼•ç”¨**
   ```cpp
   int num = 5;
   int &ref1 = num;
   // int &&ref2 = ref1; // é”™è¯¯ï¼æ²¡æœ‰å¼•ç”¨çš„å¼•ç”¨
   ```

### ç‰¹æ®Šç”¨æ³•
```cpp
// 1. æŒ‡é’ˆçš„å¼•ç”¨
int* ptr = new int(10);
int* &ptrRef = ptr; // ptrRefæ˜¯æŒ‡é’ˆptrçš„å¼•ç”¨
*ptrRef = 20;      // ä¿®æ”¹æŒ‡å‘çš„å€¼

// 2. æ•°ç»„å…ƒç´ çš„å¼•ç”¨
int arr[5] = {0};
int &first = arr[0]; // å¼•ç”¨æ•°ç»„å…ƒç´ 
first = 100;

// 3. ç»“æ„ä½“æˆå‘˜çš„å¼•ç”¨
struct Point { int x; int y; };
Point p = {10, 20};
int &xRef = p.x; // å¼•ç”¨ç»“æ„ä½“æˆå‘˜
xRef = 30;
```

## 3. å¼•ç”¨åšå‡½æ•°å‚æ•°

### ä¸‰ç§å‚æ•°ä¼ é€’æ–¹å¼å¯¹æ¯”
| ä¼ é€’æ–¹å¼ | è¯­æ³• | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| å€¼ä¼ é€’ | `void func(Type arg)` | åˆ›å»ºå‰¯æœ¬ï¼Œä¸å½±å“å®å‚ | åŸºæœ¬ç±»å‹å°å¯¹è±¡ |
| æŒ‡é’ˆä¼ é€’ | `void func(Type* ptr)` | ä¼ é€’åœ°å€ï¼Œå¯ä¿®æ”¹å®å‚ | éœ€è¦ä¿®æ”¹å®å‚ |
| **å¼•ç”¨ä¼ é€’** | `void func(Type& ref)` | æ“ä½œå®å‚çš„åˆ«å | æ¨èæ–¹å¼ï¼Œå°¤å…¶å¤§å‹å¯¹è±¡ |

### å¼•ç”¨ä¼ é€’ä¼˜åŠ¿
1. **é¿å…æ‹·è´å¼€é”€**ï¼ˆå¤§å¯¹è±¡ï¼‰
2. **å¯ä¿®æ”¹åŸå§‹æ•°æ®**
3. **è¯­æ³•æ›´ç®€æ´**ï¼ˆæ— éœ€è§£å¼•ç”¨ï¼‰

### åº”ç”¨ç¤ºä¾‹
```cpp
// äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼
void swap(int &a, int &b) {
    int temp = a;
    a = b;
    b = temp;
}

int main() {
    int x = 5, y = 10;
    swap(x, y); // ç›´æ¥ä¼ é€’å˜é‡
    cout << "x=" << x << ", y=" << y; // x=10, y=5
    return 0;
}

// ä¿®æ”¹ç»“æ„ä½“
struct Student {
    string name;
    int score;
};

void updateScore(Student &stu, int newScore) {
    stu.score = newScore;
}

int main() {
    Student s {"å¼ ä¸‰", 85};
    updateScore(s, 90); // ç›´æ¥ä¿®æ”¹åŸç»“æ„ä½“
    cout << s.score; // 90
    return 0;
}
```

## 4. å¼•ç”¨åšå‡½æ•°è¿”å›å€¼

### åŸºæœ¬ç”¨æ³•
```cpp
// è¿”å›é™æ€å˜é‡çš„å¼•ç”¨
int& getStatic() {
    static int value = 0;
    return value;
}

// è¿”å›å‡½æ•°å‚æ•°çš„å¼•ç”¨
int& max(int &a, int &b) {
    return (a > b) ? a : b;
}

int main() {
    // ä¿®æ”¹é™æ€å˜é‡
    getStatic() = 10;
    cout << getStatic(); // 10
    
    // ä¿®æ”¹è¾ƒå¤§å€¼
    int x = 5, y = 8;
    max(x, y) = 20;
    cout << "x=" << x << ", y=" << y; // x=5, y=20
    
    return 0;
}
```

### æ³¨æ„äº‹é¡¹
1. **ç¦æ­¢è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨**
   ```cpp
   int& dangerous() {
       int local = 10;
       return local; // é”™è¯¯ï¼å±€éƒ¨å˜é‡å°†è¢«é”€æ¯
   } // è¿”å›æ‚¬ç©ºå¼•ç”¨
   ```

2. **å¯è¿”å›ç±»æˆå‘˜å¼•ç”¨**
   ```cpp
   class Counter {
       int count = 0;
   public:
       int& getCount() { return count; } // å®‰å…¨
   };
   ```

3. **è¿”å›åŠ¨æ€å†…å­˜çš„å¼•ç”¨ï¼ˆéœ€è°¨æ…ï¼‰**
   ```cpp
   int& createInt() {
       int* p = new int(5);
       return *p; // å¯ä»¥ï¼Œä½†è°ƒç”¨è€…éœ€è´Ÿè´£é‡Šæ”¾
   }
   
   int main() {
       int &ref = createInt();
       cout << ref; // 5
       delete &ref; // å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾
       return 0;
   }
   ```

### åº”ç”¨åœºæ™¯
```cpp
// 1. å®ç°é“¾å¼è°ƒç”¨
class Printer {
    ostream& stream;
public:
    Printer(ostream& s) : stream(s) {}
    Printer& print(const string& msg) {
        stream << msg;
        return *this;
    }
};

Printer(cout).print("Hello").print(" World!");

// 2. é‡è½½ä¸‹æ ‡è¿ç®—ç¬¦
class IntArray {
    int data[10];
public:
    int& operator[](int index) {
        return data[index];
    }
};

IntArray arr;
arr[3] = 10; // ç­‰ä»·äº arr.operator[](3) = 10;
```

## 5. å¼•ç”¨çš„æœ¬è´¨

### åº•å±‚å®ç°
- **å¼•ç”¨æœ¬è´¨**ï¼šå¸¸é‡æŒ‡é’ˆï¼ˆ`Type* const ptr`ï¼‰
- **ç¼–è¯‘å™¨è¡Œä¸º**ï¼š
  - å¼•ç”¨å£°æ˜æ—¶è¢«è½¬æ¢ä¸ºå¸¸é‡æŒ‡é’ˆ
  - å¼•ç”¨ä½¿ç”¨æ—¶è‡ªåŠ¨è§£å¼•ç”¨

### ä»£ç å¯¹æ¯”
```cpp
// C++æºç 
int num = 10;
int &ref = num;
ref = 20;

// ç¼–è¯‘å™¨å¤„ç†ï¼ˆä¼ªä»£ç ï¼‰
int num = 10;
int* const ref = &num; // å¸¸é‡æŒ‡é’ˆ
*ref = 20;            // è‡ªåŠ¨è§£å¼•ç”¨
```

### å†…å­˜è§†è§’
```
å†…å­˜å¸ƒå±€ï¼š
å˜é‡numï¼šåœ°å€0x1000ï¼Œå€¼10
å¼•ç”¨refï¼šåœ°å€0x2000ï¼Œå­˜å‚¨å€¼0x1000ï¼ˆæŒ‡å‘numï¼‰

æ“ä½œrefï¼š
1. è¯»å–refå­˜å‚¨çš„åœ°å€0x1000
2. è®¿é—®è¯¥åœ°å€çš„å€¼
```

### å¼•ç”¨ä¸æŒ‡é’ˆçš„æ±‡ç¼–å¯¹æ¯”
```assembly
; å¼•ç”¨æ“ä½œ
mov eax, DWORD PTR [rbp-8]  ; å°†numçš„å€¼åŠ è½½åˆ°eax
mov DWORD PTR [rbp-4], eax   ; åˆå§‹åŒ–å¼•ç”¨ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–åå¯èƒ½æ— æ­¤æ“ä½œï¼‰

; æŒ‡é’ˆæ“ä½œ
lea rax, [rbp-8]             ; è·å–numçš„åœ°å€
mov QWORD PTR [rbp-16], rax  ; å­˜å‚¨æŒ‡é’ˆå€¼
mov rax, QWORD PTR [rbp-16]  ; åŠ è½½æŒ‡é’ˆ
mov DWORD PTR [rax], 20      ; é€šè¿‡æŒ‡é’ˆèµ‹å€¼
```

## 6. å¸¸é‡å¼•ç”¨

### å®šä¹‰ä¸ä½œç”¨
- **è¯­æ³•**ï¼š`const ç±»å‹ &å¼•ç”¨å = ...`
- **æ ¸å¿ƒä½œç”¨**ï¼š
  - ä¿æŠ¤æ•°æ®ä¸è¢«ä¿®æ”¹
  - æ”¯æŒä¸´æ—¶å¯¹è±¡çš„å¼•ç”¨
  - æé«˜ä¼ é€’æ•ˆç‡ï¼ˆé¿å…æ‹·è´ï¼‰

### ä½¿ç”¨åœºæ™¯
```cpp
// 1. ä¿æŠ¤å‡½æ•°å‚æ•°
void printString(const string &str) {
    cout << str;
    // str[0] = 'A'; // é”™è¯¯ï¼ä¸èƒ½ä¿®æ”¹
}

// 2. ç»‘å®šä¸´æ—¶å¯¹è±¡
const int &ref = 10; // åˆæ³•
// int &ref2 = 10;   // éæ³•ï¼éconstå¼•ç”¨ä¸èƒ½ç»‘å®šå­—é¢é‡

// 3. ç»‘å®šè¡¨è¾¾å¼ç»“æœ
int a = 5, b = 3;
const int &sumRef = a + b; // åˆæ³•
cout << sumRef; // 8

// 4. å‡½æ•°è¿”å›å¸¸é‡å¼•ç”¨
const string& getConstantString() {
    static const string s = "Hello";
    return s;
}
```

### å¸¸é‡å¼•ç”¨ä¸ç±»å‹è½¬æ¢
```cpp
// 1. ç»‘å®šä¸åŒç±»å‹ï¼ˆäº§ç”Ÿä¸´æ—¶å¯¹è±¡ï¼‰
double pi = 3.14159;
const int &intRef = pi; // åˆæ³•ï¼Œåˆ›å»ºä¸´æ—¶intå˜é‡

// ç­‰ä»·äºï¼š
const int temp = pi;   // åˆ›å»ºä¸´æ—¶å˜é‡
const int &intRef = temp;

// 2. é¿å…æ„å¤–ä¿®æ”¹
int num = 5;
const int &cref = num;
// cref = 10; // é”™è¯¯ï¼ä¸èƒ½é€šè¿‡crefä¿®æ”¹
num = 10;     // å¯ä»¥ï¼ŒåŸå§‹å˜é‡å¯ä¿®æ”¹
cout << cref; // 10
```

### æœ€ä½³å®è·µ
1. å‡½æ•°å‚æ•°ä¼˜å…ˆä½¿ç”¨å¸¸é‡å¼•ç”¨
   ```cpp
   void processData(const vector<int> &data) {
       // å¯è¯»ä¸å¯å†™ï¼Œé¿å…æ‹·è´å¤§å¯¹è±¡
   }
   ```

2. é¿å…è¿”å›å‡½æ•°å±€éƒ¨å˜é‡çš„å¸¸é‡å¼•ç”¨
   ```cpp
   const string& badExample() {
       string local = "danger";
       return local; // é”™è¯¯ï¼å±€éƒ¨å˜é‡è¢«é”€æ¯
   }
   ```

3. ç±»æˆå‘˜å‡½æ•°ä¸­çš„å¸¸é‡å¼•ç”¨è¿”å›
   ```cpp
   class Student {
       string name;
   public:
       const string& getName() const { return name; } // å®‰å…¨
   };
   ```

## ğŸš€ å¼•ç”¨é«˜çº§åº”ç”¨

### 1. èŒƒå›´forå¾ªç¯
```cpp
vector<int> nums = {1,2,3,4,5};

// å€¼æ‹·è´ï¼ˆä¿®æ”¹ä¸å½±å“åŸå…ƒç´ ï¼‰
for (int n : nums) {
    n *= 2;
}

// å¼•ç”¨ä¿®æ”¹åŸå…ƒç´ 
for (int &n : nums) {
    n *= 2;
} // numså˜ä¸º{2,4,6,8,10}

// å¸¸é‡å¼•ç”¨ï¼ˆåªè¯»è®¿é—®ï¼‰
for (const int &n : nums) {
    cout << n << " ";
}
```

### 2. å‡½æ•°å¼ç¼–ç¨‹
```cpp
// é«˜é˜¶å‡½æ•°ï¼šæ¥å—å‡½æ•°å¼•ç”¨ä½œä¸ºå‚æ•°
void transform(vector<int> &vec, int (*func)(int)) {
    for (int &elem : vec) {
        elem = func(elem);
    }
}

int square(int x) { return x * x; }

int main() {
    vector<int> data = {1,2,3,4};
    transform(data, square); // {1,4,9,16}
    return 0;
}
```

### 3. å¼•ç”¨åŒ…è£…å™¨
```cpp
#include <functional>

void callWith10(const function<void(int)> &func) {
    func(10);
}

int main() {
    int counter = 0;
    
    // å€¼æ•è·
    auto func1 = [](int x) { cout << x; };
    
    // å¼•ç”¨æ•è·
    auto func2 = [&counter](int x) { counter += x; };
    
    callWith10(func1); // è¾“å‡º10
    callWith10(func2); // counterå˜ä¸º10
    
    return 0;
}
```

## âš ï¸ å¼•ç”¨ä½¿ç”¨é™·é˜±

### 1. æ‚¬ç©ºå¼•ç”¨
```cpp
int& createDangling() {
    int x = 10;
    return x; // é”™è¯¯ï¼è¿”å›å±€éƒ¨å˜é‡å¼•ç”¨
} // xè¢«é”€æ¯

int main() {
    int &ref = createDangling();
    cout << ref; // æœªå®šä¹‰è¡Œä¸ºï¼
    return 0;
}
```

### 2. å¼•ç”¨ä¸ä¸´æ—¶å¯¹è±¡
```cpp
string getName() { return "Alice"; }

int main() {
    const string &name = getName(); // åˆæ³•ï¼Œå»¶é•¿ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
    cout << name; // æ­£ç¡®
    
    // string &name2 = getName(); // éæ³•ï¼éconstå¼•ç”¨ä¸èƒ½ç»‘å®šä¸´æ—¶å¯¹è±¡
    return 0;
}
```

### 3. å¼•ç”¨ä¸å¤šæ€
```cpp
class Base {
public:
    virtual void show() { cout << "Base\n"; }
};

class Derived : public Base {
public:
    void show() override { cout << "Derived\n"; }
};

void printType(Base &ref) {
    ref.show(); // æ­£ç¡®ï¼Œå¤šæ€
}

int main() {
    Derived d;
    printType(d); // è¾“å‡º"Derived"
    return 0;
}
```

## ğŸ“Š ç»¼åˆåº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šçŸ©é˜µè¿ç®—ç³»ç»Ÿ
```cpp
class Matrix {
    vector<vector<double>> data;
public:
    Matrix(int rows, int cols) : data(rows, vector<double>(cols)) {}
    
    // è¿”å›è¡Œå¼•ç”¨
    vector<double>& operator[](int row) {
        return data[row];
    }
    
    // å¸¸é‡ç‰ˆæœ¬
    const vector<double>& operator[](int row) const {
        return data[row];
    }
    
    // çŸ©é˜µåŠ æ³•ï¼ˆè¿”å›å¼•ç”¨ï¼‰
    Matrix& operator+=(const Matrix &other) {
        for (size_t i = 0; i < data.size(); i++) {
            for (size_t j = 0; j < data[i].size(); j++) {
                data[i][j] += other[i][j];
            }
        }
        return *this;
    }
};

int main() {
    Matrix mat(2, 2);
    mat[0][0] = 1; mat[0][1] = 2;
    mat[1][0] = 3; mat[1][1] = 4;
    
    Matrix mat2 = mat;
    mat2 += mat;
    
    cout << mat2[1][1]; // 8
    return 0;
}
```

### æ¡ˆä¾‹2ï¼šå‡½æ•°å¯¹è±¡è®¡æ•°å™¨
```cpp
class Counter {
    int count = 0;
public:
    // è¿”å›å¸¸é‡å¼•ç”¨é˜²æ­¢ä¿®æ”¹
    const int& getCount() const { return count; }
    
    // å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼ˆè¿”å›å¼•ç”¨æ”¯æŒé“¾å¼è°ƒç”¨ï¼‰
    Counter& operator()() {
        count++;
        return *this;
    }
};

int main() {
    Counter c;
    c()()()(); // é“¾å¼è°ƒç”¨
    
    cout << "è°ƒç”¨æ¬¡æ•°: " << c.getCount(); // 4
    return 0;
}
```

### æ¡ˆä¾‹3ï¼šé«˜æ•ˆå­—ç¬¦ä¸²å¤„ç†
```cpp
string concatenate(const string &s1, const string &s2) {
    return s1 + s2; // é¿å…ä¸å¿…è¦çš„æ‹·è´
}

void processText(const string &text) {
    // åªè¯»å¤„ç†å¤§æ–‡æœ¬
    cout << "å¤„ç†: " << text.substr(0, 10) << "...";
}

int main() {
    string largeText = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²...";
    
    // é«˜æ•ˆä¼ é€’
    processText(largeText);
    
    // é¿å…ä¸´æ—¶å­—ç¬¦ä¸²æ‹·è´
    const string &result = concatenate("Hello", " World");
    cout << result;
    
    return 0;
}
```

## ğŸ’ å¼•ç”¨ä½¿ç”¨é»„é‡‘æ³•åˆ™

1. **ä¼˜å…ˆå¼•ç”¨ä¼ é€’**ï¼šå‡½æ•°å‚æ•°ä¼ é€’å¤§å‹å¯¹è±¡æ—¶ä½¿ç”¨`const Type&`
2. **é¿å…è¿”å›å±€éƒ¨å¼•ç”¨**ï¼šå‡½æ•°è¿”å›å€¼ä¸è¦è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨
3. **å¸¸é‡å¼•ç”¨ç»‘å®š**ï¼šåªè¯»è®¿é—®æ—¶ä½¿ç”¨`const Type&`
4. **æ˜ç¡®æ‰€æœ‰æƒ**ï¼šè¿”å›åŠ¨æ€å†…å­˜å¼•ç”¨æ—¶éœ€æ˜ç¡®é‡Šæ”¾è´£ä»»
5. **å¼•ç”¨ä¸å¤šæ€**ï¼šåŸºç±»å¼•ç”¨å¯ç»‘å®šæ´¾ç”Ÿç±»å¯¹è±¡
6. **èŒƒå›´å¾ªç¯**ï¼šä¿®æ”¹å…ƒç´ æ—¶ä½¿ç”¨å¼•ç”¨`for(auto& elem : container)`
7. **é¿å…æ‚¬ç©ºå¼•ç”¨**ï¼šç¡®ä¿å¼•ç”¨æŒ‡å‘æœ‰æ•ˆç”Ÿå‘½å‘¨æœŸå¯¹è±¡

```cpp
// ç°ä»£C++å¼•ç”¨æœ€ä½³å®è·µ
void processData(const vector<BigObject>& input, vector<Result>& output) {
    for (const auto &item : input) { // å¸¸é‡å¼•ç”¨é¿å…æ‹·è´
        Result res = compute(item);  // å‡è®¾computeè¿”å›Result
        output.push_back(std::move(res)); // ç§»åŠ¨è¯­ä¹‰
    }
}
```